---
 - name: first add a few users that we later remove
   hosts: localhost
   remote_user: root
   vars:
     - adminusers:
       - {name: admin6, state: 'present', uid: 5006, group: "{{admingroup}}", shell: "{{adminshell}}" }
     - moreusers:
       - {name: user4, state: 'present', uid: 6004 }
   roles:
     - ansible-role-users

 - name: add and remove users
   hosts: localhost
   remote_user: root
   vars:
     - adminremove_passwords: True
     - adminusers:
       - {name: admin1, state: 'present', uid: 5001, group: "{{admingroup}}", shell: "{{adminshell}}", pubkey: "ssh-rsa KEY admin1@example.com" }
       - {name: admin2, state: 'present', uid: 5002, group: "{{admingroup}}", shell: "{{adminshell}}", pubkey: "ssh-rsa KEY admin2@example.com", groups: "agroup" }
       - {name: admin3, state: 'present', uid: 5003, groups: "{{admingroup}}", shell: "{{adminshell}}", pubkey: "ssh-rsa KEY admin3@example.com" }
       - {name: admin4, state: 'present', uid: 5004, group: "{{admingroup}}", shell: "{{adminshell}}", pubkey: "ssh-rsa KEY admin4@example.com", groups: "bgroup" }
       - {name: admin5, state: 'present', uid: 5005, group: "{{admingroup}}", shell: "{{adminshell}}", pubkey: "ssh-rsa KEY admin5@example.com", groups: "agroup,bgroup" }
       - {name: admin6, state: 'absent', uid: 5006, group: "{{admingroup}}", shell: "{{adminshell}}", pubkey: "ssh-rsa KEY admin6@example.com", groups: "agroup,bgroup" }
       - {name: admin7, state: 'absent', uid: 5007, group: "{{admingroup}}", shell: "{{adminshell}}", pubkey: "ssh-rsa KEY admin7@example.com", groups: "agroup,bgroup", comment: "commentB" }
       - {name: admin8, state: 'present', uid: 5008, group: "{{admingroup}}", shell: "{{adminshell}}", pubkey: "ssh-rsa KEY admin8@example.com", groups: "bgroup", comment: "commentB", remove: "no" }
       - {name: admin9, state: 'absent', uid: 5009, group: "{{admingroup}}", shell: "{{adminshell}}", groups: "bgroup", comment: "commentC", remove: "yes" }
       - {name: admin10, state: 'present', uid: 5010, group: "{{admingroup}}", shell: "{{adminshell}}", pubkey: "ssh-rsa KEY admin10@example.com", key_state: "absent" }
     - moreusers:
       - {name: user1, state: 'present', uid: 6001, shell: "{{adminshell}}" }
       - {name: user2, state: 'present', uid: 6002 }
       - {name: user3, state: 'absent', uid: 6003 }
       - {name: user4, state: 'absent', uid: 6004, pubkey: "ssh-rsa KEY user4@example.com", remove: "yes" }
       - {name: user5, state: 'present', uid: 6005, pubkey: "ssh-rsa KEY5 user5@example.com" }
       - {name: user6, state: 'present', uid: 6006, pubkey: "ssh-rsa KEY6 user6@example.com", options: 'command="/usr/local/bin/rrsync /allow/rrsync/here/directory",no-agent-forwarding,no-port-forwarding,no-pty,no-user-rc,no-X11-forwarding' }
       - {name: user7, state: 'absent', uid: 6007, pubkey: "ssh-rsa KEY6 user6@example.com", options: 'command="/usr/local/bin/rrsync /allow/rrsync/here/directory",no-agent-forwarding,no-port-forwarding,no-pty,no-user-rc,no-X11-forwarding' }
       - {name: user8, state: 'absent', uid: 6008, comment: "comment1", remove: "yes" }
     - anotheruserlisthere:
       - {name: training1, state: 'present', uid: 7001, shell: "{{adminshell}}" }
       - {name: training2, state: 'present', uid: 7002 }
       - {name: training3, state: 'absent', uid: 7003 }
     - admin_list_of_user_lists:
       - "{{ adminusers | default([]) }}"
       - "{{ moreusers | default([]) }}"
       - "{{ anotheruserlisthere | default([]) }}"
 
     - admin_root_keys:
       - { state: 'present', pubkey: "ssh-rsa KEY admin1@example.com" }
       - { state: 'absent', pubkey: "ssh-rsa KEY2 bad_admin2@example.com" }
     - admin_list_of_groups:
       - { name: agroup, gid: 27001 }
       - { name: bgroup, gid: 27002 }
     
   roles:
     - ansible-role-users
